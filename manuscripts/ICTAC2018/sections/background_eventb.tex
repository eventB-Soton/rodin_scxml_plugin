% !TEX root = ../SCXMLREF.tex

\subsection{Event-B}
\label{sec:eventb}

\EventB~\cite{abrial10:_model_event_b} is a formal method for system
development.  Main features of \EventB include the use of
\emph{refinement} to introduce system details gradually into the
formal model.  An \EventB model contains two parts: \emph{contexts} and \emph{machines}. Contexts contain \emph{carrier sets}, \emph{constants}, and \emph{axioms} constraining the carrier sets and constants.  Machines contain \emph{variables} |v|, \emph{invariants} |I(v)| constraining the variables, and \emph{events}. An event comprises a guard denoting its enabled-condition and an action describing how the variables are modified when the event is executed.  In general, an event |e| has the following form, where |t| are the event parameters, |G(t, v)| is the guard of the event, and |S(t, v)| is the action of the event.
\begin{center}
  |any t where G(t, v) then S(t, v) end|
%& \inlineevent{\Be}{}{\Bt}{G(\Bt,\Bv)}{}{S(\Bt,\Bv)}
\end{center}
In the case where the event has no parameters, we use the following form
\begin{center}
  |when G(v) then S(v) end|
%& \inlineevent{\Be}{}{}{G(\Bv)}{}{S(\Bv)}~,
\end{center}
and when the event has no parameters and guard, we use
\begin{center}
  |begin S(v) end|
%& \inlineevent{\Be}{}{}{}{}{S(\Bv)}~.
\end{center}
The action of an event comprises of one or more assignments, each of them has one of the following forms: (1) |v := E(t, v)|, (2) |v :: E(t, v)|, and (3) |v :âˆ£ P(t, v)|.  Assignments of form (1) are deterministic, assign value of expression |E(t, v)| to |v|.  Assignments of forms (2) and (3) are non-deterministic. (2) assigns any value from the set |E(t,v)| to |v|, while (3) assigns any value satisified predicate |P(t,v)| to |v|.
Note that invariants |I(v)| are inductive, i.e., they must be \emph{maintained} by all events. This is more strict than general safety properties which hold for all reachable states of the \EventB machine.  This is also the difference between verifying the consistency of \EventB machines using theorem proving and model checking (e.g., \PROB) techniques: model checkers explore all reachable states of the system while interpreting the invariants as safety properties.

A machine in \EventB corresponds to a transition system
where \emph{variables} represent the states and \emph{events} specify
the transitions.    More information about \EventB can be found in~\cite{hoang13:_introd_event_b_model_method}.  \EventB is supported by
\Rodin~\cite{abrial10:_rodin}, an extensible toolkit which includes
facilities for modelling, verifying the consistency of models
using theorem proving and model checking techniques, and validating
models with simulation-based approaches.

In, \EventB the run to completion pseudocode of Listing~\ref{lst:scxml-r2c} could be represented (somewhat abstractly) as showed in Listing~\ref{lst:eventb-r2c}.
\begin{lstlisting}[caption={Run to completion pseudocode in \EventB},label={lst:eventb-r2c}, language=Event-B, escapechar=|, frame=single]
 FireUntriggered // Fire  enabled untriggered transitions
when
    UC = FALSE // Has not yet completed firing untriggered transitions
    untriggered() /= {}
then
    execute(untriggered()) // Execute enabled untriggered transitions
end

UntriggeredCompleted // Untriggered transitions are completed
when
    UC = FALSE // Has not yet completed firing untriggered transitions
    untriggered() = {} // No more enabled untriggered transitions
then
    UC = TRUE // Complete firing untriggered transitions
end

FireInternallyTriggered // Fire an interal trigger
when
    UC = TRUE // Complete firing untriggered transitions
    IQ /= {} // The internal triggers queue is non-empty
then
    execute(IQ.dequeue) // Execute and dequeue from the internal triggers queue
    UC := FALSE // Re-enable firing of untriggered transitions
end

FireExternallyTriggered // Fire an external trigger
when
    UC = TRUE // Complete firing untriggered transitions
    IQ = {} // The internal trigger queue is empty
    EQ /= {} // The external trigger queue is non-empty
then
    execute(EQ.dequeue)  // Execute and dequeue from the external triggers queue
    UC := FALSE // Re-enable firing of untriggered transitions
end
\end{lstlisting}	
Here, |IQ| and |EQ| are queues of internally and externally, raised triggers, \emph{untriggered} selects a set of currently enabled untriggered transitions, \emph{dequeue} retrieves the next trigger from the given queue and selects the set of transitions that become enabled by it and \emph{execute} fires the given set of transitions. 
Note that this is an abstract representation where each event (|FireUntriggered|, |FireInternallyTriggered|, and |FireExternallyTriggered|) would be specialised to select a particular set of transitions that can be fired in parallel and |execute()| would be replaced by actions that encode the state changes made by those transitions.
Representing the condition \textbf{untriggered\_enabled} (line 3 in Listing~\ref{lst:scxml-r2c}) is cumbersome since we would need to write a conjunction of all the possible untriggered guards. Instead we introduce a dummy untriggered event that is only fired when no other selection of untriggered transitions are available and sets a boolean flag, |UC|, to indicate that none of the real untriggered events was fired and a trigger needs to be consumed.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../SCXMLREF"
%%% End:
